# =============================================================================
# Apache Spark Configuration for Data Lakehouse
# =============================================================================

# Master Configuration
spark.master                                    spark://spark-master:7077

# Application Settings
spark.app.name                                  DataLakehouse
spark.driver.memory                             2g
spark.executor.memory                           2g
spark.executor.cores                            2
spark.sql.shuffle.partitions                    10

# Iceberg Catalog Configuration
spark.sql.extensions                            org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.iceberg                       org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.iceberg.type                  rest
spark.sql.catalog.iceberg.uri                   http://iceberg-rest:8181
spark.sql.catalog.iceberg.warehouse             s3://iceberg-warehouse/
spark.sql.catalog.iceberg.io-impl               org.apache.iceberg.aws.s3.S3FileIO
spark.sql.catalog.iceberg.s3.endpoint           http://minio:9000
spark.sql.catalog.iceberg.s3.path-style-access  true
spark.sql.defaultCatalog                        iceberg

# S3/MinIO Configuration
spark.hadoop.fs.s3a.endpoint                    http://minio:9000
spark.hadoop.fs.s3a.access.key                  minioadmin
spark.hadoop.fs.s3a.secret.key                  minioadmin123
spark.hadoop.fs.s3a.path.style.access           true
spark.hadoop.fs.s3a.impl                        org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.connection.ssl.enabled      false

# Performance Tuning
spark.sql.adaptive.enabled                      true
spark.sql.adaptive.coalescePartitions.enabled   true
spark.serializer                                org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer.max                 512m

# Iceberg Write Settings
spark.sql.catalog.iceberg.write.format.default  parquet
spark.sql.parquet.compression.codec             snappy

# UI Configuration
spark.ui.enabled                                true
spark.ui.port                                   4040

# Event Logging (for Spark History Server - optional)
spark.eventLog.enabled                          false
# spark.eventLog.dir                              /opt/spark/logs
